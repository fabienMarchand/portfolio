/*! Copyright (c) 2023 Mediarithmics; All Rights Reserved */
(()=>{"use strict";({1726:function(e,r){var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var r,n=1,t=arguments.length;n<t;n++)for(var u in r=arguments[n])Object.prototype.hasOwnProperty.call(r,u)&&(e[u]=r[u]);return e}).apply(this,arguments)};function E(e){switch(e){case"EQ":case"EQUAL":case"STARTS_WITH":case"MATCHES":return[!1,function(e,r){return e||r}];default:return[!0,function(e,r){return e&&r}]}}function O(e,r,n){if(null==e)return!1;if(Array.isArray(e))return e.some(function(e){return O(e,r,n)});switch(r.type){case"NUMERIC":if(r.values&&0!==r.values.length){var t=E(r.operator),u=t[0],o=t[1],i=function(e){switch(e){case"EQUAL":case"EQ":return function(e,r){return e===r};case"NOT_EQ":case"NOT_EQUAL":return function(e,r){return e!==r};case"LT":return function(e,r){return e<r};case"LTE":return function(e,r){return e<=r};case"GT":return function(e,r){return r<e};case"GTE":return function(e,r){return r<=e};default:return function(e,r){return!1}}}(r.operator);if("boolean"==typeof e)throw"Numeric field comparison expect a string or number value but got a 'boolean' for field '".concat(n,"'");var a="string"==typeof e?parseFloat(e):e;return r.values.reduce(function(e,r){return o(e,i(a,parseFloat(r)))},u)}return!1;case"STRING":if(r.values&&0!==r.values.length){var c=String(e),t=E(r.operator),u=t[0],s=t[1],f=function(e){switch(e){case"EQUAL":case"EQ":return function(e,r){return e===r};case"NOT_EQ":case"NOT_EQUAL":return function(e,r){return e!==r};case"MATCHES":return function(e,r){return-1!==e.toLowerCase().indexOf(r.toLowerCase())};case"DOES_NOT_MATCH":return function(e,r){return-1===e.toLowerCase().indexOf(r.toLowerCase())};case"STARTS_WITH":return function(e,r){return 0===e.indexOf(r)};case"DOES_NOT_START_WITH":return function(e,r){return 0!==e.indexOf(r)};case"CONTAINS":return function(e,r){return-1!==e.indexOf(r)};case"DOES_NOT_CONTAIN":return function(e,r){return-1===e.indexOf(r)};default:return function(e,r){return!1}}}(r.operator);return r.values.reduce(function(e,r){return s(e,f(c,r))},u)}return!1;case"TIME":if("boolean"==typeof e)throw"Numeric field comparison expect a string or number value but got a 'boolean' for field '".concat(n,"'");var u=/now-(.*)d\/d/g.exec(String(r.values[0])),l=parseInt(r.values[0]);u&&!isNaN(Number(u[1]))&&(l=Date.now()-24*Number(u[1])*3600*1e3);var d=void 0;if("string"==typeof e){if(d=Date.parse(e),isNaN(d))return!1}else d=e;switch(r.operator){case"BEFORE":return r.values&&d<l;case"BEFORE_OR_EQUAL":return r.values&&d<=l;case"AFTER":return r.values&&l<d;case"AFTER_OR_EQUAL":return r.values&&l<=d}case"BOOLEAN":switch(r.operator){case"EQUAL":return r.values&&String(e)===r.values[0];case"NOT_EQUAL":return r.values&&String(e)!==r.values[0];default:return!1}case"ENUM":switch(r.operator){case"EQUAL":return r.values&&e===r.values[0];case"NOT_EQUAL":return r.values&&e!==r.values[0];default:return!1}default:throw"Syntaxe error on Comparison name"}}function t(e,r){return r.comparison&&r.field in e?r.field in e&&O(e[r.field],r.comparison,r.field):r.existence?function(e,r){switch(r){case"EXISTS":return e;case"DOES_NOT_EXIST":return!e;default:throw"Syntaxe error: existence operation unkown"}}(r.field in e,r.existence):r.field in e}function u(e,r){var n=e.filter(function(e){return function(e,r,n){if(0===e.length)return!0;var t="AND"===r?function(e,r){return e&&r}:function(e,r){return e||r};return e.reduce(function(e,r){return t(e,n&&o(n,r))},!("AND"!==r))}(r.expressions,r.boolean_operator,e)});if(0!==n.length&&r.score_function){if(r.score_field&&!e.some(function(e){return r.score_field in e}))throw"Error: score_field does not exist in the processed object";var t=function(e,r,n,t){if(n&&!e.some(function(e){return isNaN(Number(e[n]))}))switch(r){case"SUM":return e.reduce(function(e,r){return e+r[n]},0);case"AVG":return e.reduce(function(e,r){return e+r[n]},0)/e.length;case"MIN":return e.reduce(function(e,r){return r[n]<e?r[n]:e},e[0][n]);case"MAX":return e.reduce(function(e,r){return r[n]>e?r[n]:e},e[0][n]);default:throw"score_function unknown"}var u=e.length;return"AVG"===r&&(u/=t),u}(n,r.score_function,r.score_field,e.length),t=(r.min_score||1)<=t}else t=0!==n.length;return r.negation?!t:t}function o(e,r){switch(r.type){case"GROUP":return u([e],r);case"OBJECT":return r.field in e&&(Array.isArray(e[r.field])?u(e[r.field],r):u([e[r.field]],r));case"FIELD":return t(e,r);case"TAXONOMY_OBJECT":throw"TAXONOMY_OBJECT not implemented yet";default:return!1}}Object.defineProperty(r,"__esModule",{value:!0}),window.mics=n(n({},window.mics),{evaluateExpression:o}),window.mics&&window.mics._setEvaluator&&window.mics._setEvaluator(o)}})[1726](0,{})})();